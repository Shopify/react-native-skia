{"version":3,"names":["enumKey","processPath","NodeType","Path1DEffectStyle","composeDeclarations","CommandType","declareDiscretePathEffect","ctx","props","length","deviation","seed","pe","Skia","PathEffect","MakeDiscrete","pathEffects","push","declarePath2DPathEffect","matrix","path","MakePath2D","Error","declareDashPathEffect","intervals","phase","MakeDash","declareCornerPathEffect","r","MakeCorner","declareSumPathEffect","pes","splice","MakeSum","bind","declareLine2DPathEffect","width","MakeLine2D","declarePath1DPathEffect","advance","style","MakePath1D","isPushPathEffect","command","type","PushPathEffect","isPathEffect","pathEffectType","composePathEffects","outer","pop","inner","MakeCompose","pushPathEffect","DiscretePathEffect","DashPathEffect","Path1DPathEffect","Path2DPathEffect","CornerPathEffect","SumPathEffect","Line2DPathEffect","imageFilterType"],"sources":["PathEffects.ts"],"sourcesContent":["import { enumKey, processPath } from \"../../../dom/nodes\";\nimport { NodeType } from \"../../../dom/types\";\nimport type {\n  CornerPathEffectProps,\n  DashPathEffectProps,\n  DiscretePathEffectProps,\n  Line2DPathEffectProps,\n  Path1DPathEffectProps,\n  Path2DPathEffectProps,\n} from \"../../../dom/types\";\nimport { Path1DEffectStyle } from \"../../../skia/types\";\nimport { composeDeclarations } from \"../../utils\";\nimport type { Command } from \"../Core\";\nimport { CommandType } from \"../Core\";\nimport type { DrawingContext } from \"../DrawingContext\";\n\nconst declareDiscretePathEffect = (\n  ctx: DrawingContext,\n  props: DiscretePathEffectProps\n) => {\n  \"worklet\";\n  const { length, deviation, seed } = props;\n  const pe = ctx.Skia.PathEffect.MakeDiscrete(length, deviation, seed);\n  ctx.pathEffects.push(pe);\n};\n\nconst declarePath2DPathEffect = (\n  ctx: DrawingContext,\n  props: Path2DPathEffectProps\n) => {\n  \"worklet\";\n  const { matrix } = props;\n  const path = processPath(ctx.Skia, props.path);\n  const pe = ctx.Skia.PathEffect.MakePath2D(matrix, path);\n  if (pe === null) {\n    throw new Error(\"Path2DPathEffect: invalid path\");\n  }\n  ctx.pathEffects.push(pe);\n};\n\nconst declareDashPathEffect = (\n  ctx: DrawingContext,\n  props: DashPathEffectProps\n) => {\n  \"worklet\";\n  const { intervals, phase } = props;\n  const pe = ctx.Skia.PathEffect.MakeDash(intervals, phase);\n  ctx.pathEffects.push(pe);\n};\n\nconst declareCornerPathEffect = (\n  ctx: DrawingContext,\n  props: CornerPathEffectProps\n) => {\n  \"worklet\";\n  const { r } = props;\n  const pe = ctx.Skia.PathEffect.MakeCorner(r);\n  if (pe === null) {\n    throw new Error(\"CornerPathEffect: couldn't create path effect\");\n  }\n  ctx.pathEffects.push(pe);\n};\n\nconst declareSumPathEffect = (ctx: DrawingContext) => {\n  \"worklet\";\n  // Note: decorateChildren functionality needs to be handled differently\n  const pes = ctx.pathEffects.splice(0, ctx.pathEffects.length);\n  const pe = composeDeclarations(\n    pes,\n    ctx.Skia.PathEffect.MakeSum.bind(ctx.Skia.PathEffect)\n  );\n  ctx.pathEffects.push(pe);\n};\n\nconst declareLine2DPathEffect = (\n  ctx: DrawingContext,\n  props: Line2DPathEffectProps\n) => {\n  \"worklet\";\n  const { width, matrix } = props;\n  const pe = ctx.Skia.PathEffect.MakeLine2D(width, matrix);\n  if (pe === null) {\n    throw new Error(\"Line2DPathEffect: could not create path effect\");\n  }\n  ctx.pathEffects.push(pe);\n};\n\nconst declarePath1DPathEffect = (\n  ctx: DrawingContext,\n  props: Path1DPathEffectProps\n) => {\n  \"worklet\";\n  const { advance, phase, style } = props;\n  const path = processPath(ctx.Skia, props.path);\n  const pe = ctx.Skia.PathEffect.MakePath1D(\n    path,\n    advance,\n    phase,\n    Path1DEffectStyle[enumKey(style)]\n  );\n  if (pe === null) {\n    throw new Error(\"Path1DPathEffect: could not create path effect\");\n  }\n  ctx.pathEffects.push(pe);\n};\n\nexport const isPushPathEffect = (\n  command: Command\n): command is Command<CommandType.PushPathEffect> => {\n  \"worklet\";\n  return command.type === CommandType.PushPathEffect;\n};\n\ntype Props = {\n  [NodeType.DiscretePathEffect]: DiscretePathEffectProps;\n  [NodeType.DashPathEffect]: DashPathEffectProps;\n  [NodeType.Path1DPathEffect]: Path1DPathEffectProps;\n  [NodeType.Path2DPathEffect]: Path2DPathEffectProps;\n  [NodeType.CornerPathEffect]: CornerPathEffectProps;\n  [NodeType.SumPathEffect]: Record<string, never>;\n  [NodeType.Line2DPathEffect]: Line2DPathEffectProps;\n};\n\ninterface PushPathEffect<T extends keyof Props>\n  extends Command<CommandType.PushPathEffect> {\n  pathEffectType: T;\n  props: Props[T];\n}\n\nconst isPathEffect = <T extends keyof Props>(\n  command: Command<CommandType.PushPathEffect>,\n  type: T\n): command is PushPathEffect<T> => {\n  \"worklet\";\n  return command.pathEffectType === type;\n};\n\nexport const composePathEffects = (ctx: DrawingContext) => {\n  \"worklet\";\n  if (ctx.pathEffects.length > 1) {\n    const outer = ctx.pathEffects.pop()!;\n    const inner = ctx.pathEffects.pop()!;\n    ctx.pathEffects.push(ctx.Skia.PathEffect.MakeCompose(outer, inner));\n  }\n};\n\nexport const pushPathEffect = (\n  ctx: DrawingContext,\n  command: Command<CommandType.PushPathEffect>\n) => {\n  \"worklet\";\n  if (isPathEffect(command, NodeType.DiscretePathEffect)) {\n    declareDiscretePathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.DashPathEffect)) {\n    declareDashPathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.Path1DPathEffect)) {\n    declarePath1DPathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.Path2DPathEffect)) {\n    declarePath2DPathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.CornerPathEffect)) {\n    declareCornerPathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.SumPathEffect)) {\n    declareSumPathEffect(ctx);\n  } else if (isPathEffect(command, NodeType.Line2DPathEffect)) {\n    declareLine2DPathEffect(ctx, command.props);\n  } else {\n    throw new Error(\"Invalid image filter type: \" + command.imageFilterType);\n  }\n};\n"],"mappings":"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","ignoreList":[]}