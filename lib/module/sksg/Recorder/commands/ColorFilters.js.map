{"version":3,"names":["enumKey","processColor","NodeType","BlendMode","CommandType","isPushColorFilter","command","type","PushColorFilter","isColorFilter","colorFilterType","composeColorFilters","ctx","colorFilters","length","outer","pop","inner","push","Skia","ColorFilter","MakeCompose","pushColorFilter","cf","BlendColorFilter","props","mode","color","MakeBlend","MatrixColorFilter","matrix","MakeMatrix","LerpColorFilter","t","second","first","Error","MakeLerp","LumaColorFilter","MakeLumaColorFilter","LinearToSRGBGammaColorFilter","MakeLinearToSRGBGamma","SRGBToLinearGammaColorFilter","MakeSRGBToLinearGamma"],"sources":["ColorFilters.ts"],"sourcesContent":["import { enumKey, processColor } from \"../../../dom/nodes\";\nimport type {\n  BlendColorFilterProps,\n  LerpColorFilterProps,\n  MatrixColorFilterProps,\n} from \"../../../dom/types\";\nimport { NodeType } from \"../../../dom/types\";\nimport type { SkColorFilter } from \"../../../skia/types\";\nimport { BlendMode } from \"../../../skia/types\";\nimport { CommandType } from \"../Core\";\nimport type { Command } from \"../Core\";\nimport type { DrawingContext } from \"../DrawingContext\";\n\nexport const isPushColorFilter = (\n  command: Command\n): command is Command<CommandType.PushColorFilter> => {\n  \"worklet\";\n  return command.type === CommandType.PushColorFilter;\n};\n\ntype Props = {\n  [NodeType.BlendColorFilter]: BlendColorFilterProps;\n  [NodeType.MatrixColorFilter]: MatrixColorFilterProps;\n  [NodeType.LerpColorFilter]: LerpColorFilterProps;\n  [NodeType.LumaColorFilter]: Record<string, never>;\n  [NodeType.LinearToSRGBGammaColorFilter]: Record<string, never>;\n  [NodeType.SRGBToLinearGammaColorFilter]: Record<string, never>;\n};\n\ninterface PushColorFilter<T extends keyof Props>\n  extends Command<CommandType.PushColorFilter> {\n  colorFilterType: T;\n  props: Props[T];\n}\n\nconst isColorFilter = <T extends keyof Props>(\n  command: Command<CommandType.PushColorFilter>,\n  type: T\n): command is PushColorFilter<T> => {\n  \"worklet\";\n  return command.colorFilterType === type;\n};\n\nexport const composeColorFilters = (ctx: DrawingContext) => {\n  \"worklet\";\n  if (ctx.colorFilters.length > 1) {\n    const outer = ctx.colorFilters.pop()!;\n    const inner = ctx.colorFilters.pop()!;\n    ctx.colorFilters.push(ctx.Skia.ColorFilter.MakeCompose(outer, inner));\n  }\n};\n\nexport const pushColorFilter = (\n  ctx: DrawingContext,\n  command: Command<CommandType.PushColorFilter>\n) => {\n  \"worklet\";\n  let cf: SkColorFilter | undefined;\n  if (isColorFilter(command, NodeType.BlendColorFilter)) {\n    const { props } = command;\n    const { mode } = props;\n    const color = processColor(ctx.Skia, props.color);\n    cf = ctx.Skia.ColorFilter.MakeBlend(color, BlendMode[enumKey(mode)]);\n  } else if (isColorFilter(command, NodeType.MatrixColorFilter)) {\n    const { matrix } = command.props;\n    cf = ctx.Skia.ColorFilter.MakeMatrix(matrix);\n  } else if (isColorFilter(command, NodeType.LerpColorFilter)) {\n    const { props } = command;\n    const { t } = props;\n    const second = ctx.colorFilters.pop();\n    const first = ctx.colorFilters.pop();\n    if (!first || !second) {\n      throw new Error(\"LerpColorFilter requires two color filters\");\n    }\n    cf = ctx.Skia.ColorFilter.MakeLerp(t, first, second);\n  } else if (isColorFilter(command, NodeType.LumaColorFilter)) {\n    cf = ctx.Skia.ColorFilter.MakeLumaColorFilter();\n  } else if (isColorFilter(command, NodeType.LinearToSRGBGammaColorFilter)) {\n    cf = ctx.Skia.ColorFilter.MakeLinearToSRGBGamma();\n  } else if (isColorFilter(command, NodeType.SRGBToLinearGammaColorFilter)) {\n    cf = ctx.Skia.ColorFilter.MakeSRGBToLinearGamma();\n  }\n  if (!cf) {\n    throw new Error(`Unknown color filter type: ${command.colorFilterType}`);\n  }\n  ctx.colorFilters.push(cf);\n};\n"],"mappings":"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","ignoreList":[]}