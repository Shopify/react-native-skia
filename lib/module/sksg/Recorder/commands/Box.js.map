{"version":3,"names":["deflate","inflate","processColor","BlurStyle","ClipOp","isRRect","CommandType","materializeCommand","isBoxCommand","command","type","DrawBox","drawBox","ctx","shadows","map","shadow","props","paint","Skia","canvas","box","defaultBox","opacity","getAlphaf","RRectXY","filter","inner","color","blur","spread","dx","dy","lPaint","Paint","setColor","setAlphaf","setMaskFilter","MaskFilter","MakeBlur","Normal","drawRRect","delta","Point","Math","abs","save","clipRRect","Intersect","Color","outer","x","y","drawDRRect","restore"],"sources":["Box.ts"],"sourcesContent":["import { deflate, inflate, processColor } from \"../../../dom/nodes\";\nimport type { BoxProps, BoxShadowProps } from \"../../../dom/types\";\nimport { BlurStyle, ClipOp, isRRect } from \"../../../skia/types\";\nimport type { Command } from \"../Core\";\nimport { CommandType, materializeCommand } from \"../Core\";\nimport type { DrawingContext } from \"../DrawingContext\";\n\ninterface BoxCommand extends Command<CommandType.DrawBox> {\n  props: BoxProps;\n  shadows: { props: BoxShadowProps }[];\n}\n\nexport const isBoxCommand = (command: Command): command is BoxCommand => {\n  \"worklet\";\n  return command.type === CommandType.DrawBox;\n};\n\nexport const drawBox = (ctx: DrawingContext, command: BoxCommand) => {\n  \"worklet\";\n  const shadows = command.shadows.map((shadow) => {\n    return materializeCommand(shadow).props;\n  });\n  const { paint, Skia, canvas } = ctx;\n  const { box: defaultBox } = command.props;\n  const opacity = paint.getAlphaf();\n  const box = isRRect(defaultBox) ? defaultBox : Skia.RRectXY(defaultBox, 0, 0);\n  shadows\n    .filter((shadow) => !shadow.inner)\n    .map((shadow) => {\n      const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n      const lPaint = Skia.Paint();\n      lPaint.setColor(processColor(Skia, color));\n      lPaint.setAlphaf(lPaint.getAlphaf() * opacity);\n      lPaint.setMaskFilter(\n        Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n      );\n      canvas.drawRRect(inflate(Skia, box, spread, spread, dx, dy), lPaint);\n    });\n\n  canvas.drawRRect(box, paint);\n\n  shadows\n    .filter((shadow) => shadow.inner)\n    .map((shadow) => {\n      const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n      const delta = Skia.Point(10 + Math.abs(dx), 10 + Math.abs(dy));\n      canvas.save();\n      canvas.clipRRect(box, ClipOp.Intersect, false);\n      const lPaint = Skia.Paint();\n      lPaint.setColor(Skia.Color(color));\n      lPaint.setAlphaf(lPaint.getAlphaf() * opacity);\n\n      lPaint.setMaskFilter(\n        Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n      );\n      const inner = deflate(Skia, box, spread, spread, dx, dy);\n      const outer = inflate(Skia, box, delta.x, delta.y);\n      canvas.drawDRRect(outer, inner, lPaint);\n      canvas.restore();\n    });\n};\n"],"mappings":"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","ignoreList":[]}