{"version":3,"names":["createDrawingContext","Skia","paintPool","canvas","paints","colorFilters","shaders","imageFilters","pathEffects","paintDeclarations","nextPaintIndex","Paint","push","savePaint","length","nextPaint","assign","getCurrentPaint","saveBackdropFilter","imageFilter","imgf","pop","cf","ImageFilter","MakeColorFilter","saveLayer","undefined","restore","restorePaint","materializePaint","setColorFilter","reduceRight","inner","outer","ColorFilter","MakeCompose","setShader","setImageFilter","setPathEffect","PathEffect","paint","exports"],"sources":["DrawingContext.ts"],"sourcesContent":["import type {\n  Skia,\n  SkCanvas,\n  SkColorFilter,\n  SkPaint,\n  SkShader,\n  SkImageFilter,\n  SkPathEffect,\n} from \"../../skia/types\";\n\nexport const createDrawingContext = (\n  Skia: Skia,\n  paintPool: SkPaint[],\n  canvas: SkCanvas\n) => {\n  \"worklet\";\n\n  // State (formerly class fields)\n  const paints: SkPaint[] = [];\n  const colorFilters: SkColorFilter[] = [];\n  const shaders: SkShader[] = [];\n  const imageFilters: SkImageFilter[] = [];\n  const pathEffects: SkPathEffect[] = [];\n  const paintDeclarations: SkPaint[] = [];\n\n  let nextPaintIndex = 1;\n\n  // Initialize first paint\n  paintPool[0] = Skia.Paint();\n  paints.push(paintPool[0]);\n\n  // Methods (formerly class methods)\n  const savePaint = () => {\n    // Get next available paint from pool or create new one if needed\n    if (nextPaintIndex >= paintPool.length) {\n      paintPool.push(Skia.Paint());\n    }\n\n    const nextPaint = paintPool[nextPaintIndex];\n    nextPaint.assign(getCurrentPaint()); // Reuse allocation by copying properties\n    paints.push(nextPaint);\n    nextPaintIndex++;\n  };\n\n  const saveBackdropFilter = () => {\n    let imageFilter: SkImageFilter | null = null;\n    const imgf = imageFilters.pop();\n    if (imgf) {\n      imageFilter = imgf;\n    } else {\n      const cf = colorFilters.pop();\n      if (cf) {\n        imageFilter = Skia.ImageFilter.MakeColorFilter(cf, null);\n      }\n    }\n    canvas.saveLayer(undefined, null, imageFilter);\n    canvas.restore();\n  };\n\n  // Equivalent to the `get paint()` getter in the original class\n  const getCurrentPaint = () => {\n    return paints[paints.length - 1];\n  };\n\n  const restorePaint = () => {\n    return paints.pop();\n  };\n\n  const materializePaint = () => {\n    // Color Filters\n    if (colorFilters.length > 0) {\n      getCurrentPaint().setColorFilter(\n        colorFilters.reduceRight((inner, outer) =>\n          inner ? Skia.ColorFilter.MakeCompose(outer, inner) : outer\n        )\n      );\n    }\n    // Shaders\n    if (shaders.length > 0) {\n      getCurrentPaint().setShader(shaders[shaders.length - 1]);\n    }\n    // Image Filters\n    if (imageFilters.length > 0) {\n      getCurrentPaint().setImageFilter(\n        imageFilters.reduceRight((inner, outer) =>\n          inner ? Skia.ImageFilter.MakeCompose(outer, inner) : outer\n        )\n      );\n    }\n\n    // Path Effects\n    if (pathEffects.length > 0) {\n      getCurrentPaint().setPathEffect(\n        pathEffects.reduceRight((inner, outer) =>\n          inner ? Skia.PathEffect.MakeCompose(outer, inner) : outer\n        )\n      );\n    }\n\n    // Clear arrays\n    colorFilters.length = 0;\n    shaders.length = 0;\n    imageFilters.length = 0;\n    pathEffects.length = 0;\n  };\n\n  // Return an object containing the Skia reference, the canvas, and the methods\n  return {\n    // Public fields\n    Skia,\n    canvas,\n    paints,\n    colorFilters,\n    shaders,\n    imageFilters,\n    pathEffects,\n    paintDeclarations,\n    paintPool,\n\n    // Public methods\n    savePaint,\n    saveBackdropFilter,\n    get paint() {\n      return paints[paints.length - 1];\n    }, // the \"getter\" for the current paint\n    restorePaint,\n    materializePaint,\n  };\n};\n\nexport type DrawingContext = ReturnType<typeof createDrawingContext>;\n"],"mappings":"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","ignoreList":[]}