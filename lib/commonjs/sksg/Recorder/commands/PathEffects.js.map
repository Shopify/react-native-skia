{"version":3,"names":["_nodes","require","_types","_types2","_utils","_Core","declareDiscretePathEffect","ctx","props","length","deviation","seed","pe","Skia","PathEffect","MakeDiscrete","pathEffects","push","declarePath2DPathEffect","matrix","path","processPath","MakePath2D","Error","declareDashPathEffect","intervals","phase","MakeDash","declareCornerPathEffect","r","MakeCorner","declareSumPathEffect","pes","splice","composeDeclarations","MakeSum","bind","declareLine2DPathEffect","width","MakeLine2D","declarePath1DPathEffect","advance","style","MakePath1D","Path1DEffectStyle","enumKey","isPushPathEffect","command","type","CommandType","PushPathEffect","exports","isPathEffect","pathEffectType","composePathEffects","outer","pop","inner","MakeCompose","pushPathEffect","NodeType","DiscretePathEffect","DashPathEffect","Path1DPathEffect","Path2DPathEffect","CornerPathEffect","SumPathEffect","Line2DPathEffect","imageFilterType"],"sources":["PathEffects.ts"],"sourcesContent":["import { enumKey, processPath } from \"../../../dom/nodes\";\nimport { NodeType } from \"../../../dom/types\";\nimport type {\n  CornerPathEffectProps,\n  DashPathEffectProps,\n  DiscretePathEffectProps,\n  Line2DPathEffectProps,\n  Path1DPathEffectProps,\n  Path2DPathEffectProps,\n} from \"../../../dom/types\";\nimport { Path1DEffectStyle } from \"../../../skia/types\";\nimport { composeDeclarations } from \"../../utils\";\nimport type { Command } from \"../Core\";\nimport { CommandType } from \"../Core\";\nimport type { DrawingContext } from \"../DrawingContext\";\n\nconst declareDiscretePathEffect = (\n  ctx: DrawingContext,\n  props: DiscretePathEffectProps\n) => {\n  \"worklet\";\n  const { length, deviation, seed } = props;\n  const pe = ctx.Skia.PathEffect.MakeDiscrete(length, deviation, seed);\n  ctx.pathEffects.push(pe);\n};\n\nconst declarePath2DPathEffect = (\n  ctx: DrawingContext,\n  props: Path2DPathEffectProps\n) => {\n  \"worklet\";\n  const { matrix } = props;\n  const path = processPath(ctx.Skia, props.path);\n  const pe = ctx.Skia.PathEffect.MakePath2D(matrix, path);\n  if (pe === null) {\n    throw new Error(\"Path2DPathEffect: invalid path\");\n  }\n  ctx.pathEffects.push(pe);\n};\n\nconst declareDashPathEffect = (\n  ctx: DrawingContext,\n  props: DashPathEffectProps\n) => {\n  \"worklet\";\n  const { intervals, phase } = props;\n  const pe = ctx.Skia.PathEffect.MakeDash(intervals, phase);\n  ctx.pathEffects.push(pe);\n};\n\nconst declareCornerPathEffect = (\n  ctx: DrawingContext,\n  props: CornerPathEffectProps\n) => {\n  \"worklet\";\n  const { r } = props;\n  const pe = ctx.Skia.PathEffect.MakeCorner(r);\n  if (pe === null) {\n    throw new Error(\"CornerPathEffect: couldn't create path effect\");\n  }\n  ctx.pathEffects.push(pe);\n};\n\nconst declareSumPathEffect = (ctx: DrawingContext) => {\n  \"worklet\";\n  // Note: decorateChildren functionality needs to be handled differently\n  const pes = ctx.pathEffects.splice(0, ctx.pathEffects.length);\n  const pe = composeDeclarations(\n    pes,\n    ctx.Skia.PathEffect.MakeSum.bind(ctx.Skia.PathEffect)\n  );\n  ctx.pathEffects.push(pe);\n};\n\nconst declareLine2DPathEffect = (\n  ctx: DrawingContext,\n  props: Line2DPathEffectProps\n) => {\n  \"worklet\";\n  const { width, matrix } = props;\n  const pe = ctx.Skia.PathEffect.MakeLine2D(width, matrix);\n  if (pe === null) {\n    throw new Error(\"Line2DPathEffect: could not create path effect\");\n  }\n  ctx.pathEffects.push(pe);\n};\n\nconst declarePath1DPathEffect = (\n  ctx: DrawingContext,\n  props: Path1DPathEffectProps\n) => {\n  \"worklet\";\n  const { advance, phase, style } = props;\n  const path = processPath(ctx.Skia, props.path);\n  const pe = ctx.Skia.PathEffect.MakePath1D(\n    path,\n    advance,\n    phase,\n    Path1DEffectStyle[enumKey(style)]\n  );\n  if (pe === null) {\n    throw new Error(\"Path1DPathEffect: could not create path effect\");\n  }\n  ctx.pathEffects.push(pe);\n};\n\nexport const isPushPathEffect = (\n  command: Command\n): command is Command<CommandType.PushPathEffect> => {\n  \"worklet\";\n  return command.type === CommandType.PushPathEffect;\n};\n\ntype Props = {\n  [NodeType.DiscretePathEffect]: DiscretePathEffectProps;\n  [NodeType.DashPathEffect]: DashPathEffectProps;\n  [NodeType.Path1DPathEffect]: Path1DPathEffectProps;\n  [NodeType.Path2DPathEffect]: Path2DPathEffectProps;\n  [NodeType.CornerPathEffect]: CornerPathEffectProps;\n  [NodeType.SumPathEffect]: Record<string, never>;\n  [NodeType.Line2DPathEffect]: Line2DPathEffectProps;\n};\n\ninterface PushPathEffect<T extends keyof Props>\n  extends Command<CommandType.PushPathEffect> {\n  pathEffectType: T;\n  props: Props[T];\n}\n\nconst isPathEffect = <T extends keyof Props>(\n  command: Command<CommandType.PushPathEffect>,\n  type: T\n): command is PushPathEffect<T> => {\n  \"worklet\";\n  return command.pathEffectType === type;\n};\n\nexport const composePathEffects = (ctx: DrawingContext) => {\n  \"worklet\";\n  if (ctx.pathEffects.length > 1) {\n    const outer = ctx.pathEffects.pop()!;\n    const inner = ctx.pathEffects.pop()!;\n    ctx.pathEffects.push(ctx.Skia.PathEffect.MakeCompose(outer, inner));\n  }\n};\n\nexport const pushPathEffect = (\n  ctx: DrawingContext,\n  command: Command<CommandType.PushPathEffect>\n) => {\n  \"worklet\";\n  if (isPathEffect(command, NodeType.DiscretePathEffect)) {\n    declareDiscretePathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.DashPathEffect)) {\n    declareDashPathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.Path1DPathEffect)) {\n    declarePath1DPathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.Path2DPathEffect)) {\n    declarePath2DPathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.CornerPathEffect)) {\n    declareCornerPathEffect(ctx, command.props);\n  } else if (isPathEffect(command, NodeType.SumPathEffect)) {\n    declareSumPathEffect(ctx);\n  } else if (isPathEffect(command, NodeType.Line2DPathEffect)) {\n    declareLine2DPathEffect(ctx, command.props);\n  } else {\n    throw new Error(\"Invalid image filter type: \" + command.imageFilterType);\n  }\n};\n"],"mappings":"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","ignoreList":[]}