{"version":3,"names":["_nodes","require","_types","computeClip","Skia","clip","isPathDef","clipPath","processPath","isRRect","clipRRect","clipRect","undefined","saveCTM","ctx","props","canvas","rawClip","invertClip","matrix","transform","origin","layer","hasTransform","hasClip","op","ClipOp","Difference","Intersect","m3","processTransformProps2","shouldSave","saveLayer","save","concat","exports"],"sources":["CTM.ts"],"sourcesContent":["import {\n  isPathDef,\n  processPath,\n  processTransformProps2,\n} from \"../../../dom/nodes\";\nimport type { ClipDef, CTMProps } from \"../../../dom/types\";\nimport type { Skia, SkPath, SkRect, SkRRect } from \"../../../skia/types\";\nimport { ClipOp, isRRect } from \"../../../skia/types\";\nimport type { DrawingContext } from \"../DrawingContext\";\n\nconst computeClip = (\n  Skia: Skia,\n  clip: ClipDef | undefined\n):\n  | undefined\n  | { clipPath: SkPath }\n  | { clipRect: SkRect }\n  | { clipRRect: SkRRect } => {\n  \"worklet\";\n  if (clip) {\n    if (isPathDef(clip)) {\n      return { clipPath: processPath(Skia, clip) };\n    } else if (isRRect(clip)) {\n      return { clipRRect: clip };\n    } else {\n      return { clipRect: clip };\n    }\n  }\n  return undefined;\n};\n\nexport const saveCTM = (ctx: DrawingContext, props: CTMProps) => {\n  \"worklet\";\n  const { canvas, Skia } = ctx;\n  const {\n    clip: rawClip,\n    invertClip,\n    matrix,\n    transform,\n    origin,\n    layer,\n  } = props as CTMProps;\n  const hasTransform = matrix !== undefined || transform !== undefined;\n  const clip = computeClip(Skia, rawClip);\n  const hasClip = clip !== undefined;\n  const op = invertClip ? ClipOp.Difference : ClipOp.Intersect;\n  const m3 = processTransformProps2(Skia, { matrix, transform, origin });\n  const shouldSave = hasTransform || hasClip || !!layer;\n  if (shouldSave) {\n    if (layer) {\n      if (typeof layer === \"boolean\") {\n        canvas.saveLayer();\n      } else {\n        canvas.saveLayer(layer);\n      }\n    } else {\n      canvas.save();\n    }\n  }\n  if (m3) {\n    canvas.concat(m3);\n  }\n  if (clip) {\n    if (\"clipRect\" in clip) {\n      canvas.clipRect(clip.clipRect, op, true);\n    } else if (\"clipRRect\" in clip) {\n      canvas.clipRRect(clip.clipRRect, op, true);\n    } else {\n      canvas.clipPath(clip.clipPath, op, true);\n    }\n  }\n};\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAOA,IAAAC,MAAA,GAAAD,OAAA;AAGA,MAAME,WAAW,GAAGA,CAClBC,IAAU,EACVC,IAAyB,KAKG;EAC5B,SAAS;;EACT,IAAIA,IAAI,EAAE;IACR,IAAI,IAAAC,gBAAS,EAACD,IAAI,CAAC,EAAE;MACnB,OAAO;QAAEE,QAAQ,EAAE,IAAAC,kBAAW,EAACJ,IAAI,EAAEC,IAAI;MAAE,CAAC;IAC9C,CAAC,MAAM,IAAI,IAAAI,cAAO,EAACJ,IAAI,CAAC,EAAE;MACxB,OAAO;QAAEK,SAAS,EAAEL;MAAK,CAAC;IAC5B,CAAC,MAAM;MACL,OAAO;QAAEM,QAAQ,EAAEN;MAAK,CAAC;IAC3B;EACF;EACA,OAAOO,SAAS;AAClB,CAAC;AAEM,MAAMC,OAAO,GAAGA,CAACC,GAAmB,EAAEC,KAAe,KAAK;EAC/D,SAAS;;EACT,MAAM;IAAEC,MAAM;IAAEZ;EAAK,CAAC,GAAGU,GAAG;EAC5B,MAAM;IACJT,IAAI,EAAEY,OAAO;IACbC,UAAU;IACVC,MAAM;IACNC,SAAS;IACTC,MAAM;IACNC;EACF,CAAC,GAAGP,KAAiB;EACrB,MAAMQ,YAAY,GAAGJ,MAAM,KAAKP,SAAS,IAAIQ,SAAS,KAAKR,SAAS;EACpE,MAAMP,IAAI,GAAGF,WAAW,CAACC,IAAI,EAAEa,OAAO,CAAC;EACvC,MAAMO,OAAO,GAAGnB,IAAI,KAAKO,SAAS;EAClC,MAAMa,EAAE,GAAGP,UAAU,GAAGQ,aAAM,CAACC,UAAU,GAAGD,aAAM,CAACE,SAAS;EAC5D,MAAMC,EAAE,GAAG,IAAAC,6BAAsB,EAAC1B,IAAI,EAAE;IAAEe,MAAM;IAAEC,SAAS;IAAEC;EAAO,CAAC,CAAC;EACtE,MAAMU,UAAU,GAAGR,YAAY,IAAIC,OAAO,IAAI,CAAC,CAACF,KAAK;EACrD,IAAIS,UAAU,EAAE;IACd,IAAIT,KAAK,EAAE;MACT,IAAI,OAAOA,KAAK,KAAK,SAAS,EAAE;QAC9BN,MAAM,CAACgB,SAAS,CAAC,CAAC;MACpB,CAAC,MAAM;QACLhB,MAAM,CAACgB,SAAS,CAACV,KAAK,CAAC;MACzB;IACF,CAAC,MAAM;MACLN,MAAM,CAACiB,IAAI,CAAC,CAAC;IACf;EACF;EACA,IAAIJ,EAAE,EAAE;IACNb,MAAM,CAACkB,MAAM,CAACL,EAAE,CAAC;EACnB;EACA,IAAIxB,IAAI,EAAE;IACR,IAAI,UAAU,IAAIA,IAAI,EAAE;MACtBW,MAAM,CAACL,QAAQ,CAACN,IAAI,CAACM,QAAQ,EAAEc,EAAE,EAAE,IAAI,CAAC;IAC1C,CAAC,MAAM,IAAI,WAAW,IAAIpB,IAAI,EAAE;MAC9BW,MAAM,CAACN,SAAS,CAACL,IAAI,CAACK,SAAS,EAAEe,EAAE,EAAE,IAAI,CAAC;IAC5C,CAAC,MAAM;MACLT,MAAM,CAACT,QAAQ,CAACF,IAAI,CAACE,QAAQ,EAAEkB,EAAE,EAAE,IAAI,CAAC;IAC1C;EACF;AACF,CAAC;AAACU,OAAA,CAAAtB,OAAA,GAAAA,OAAA","ignoreList":[]}