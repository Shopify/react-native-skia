{"version":3,"names":["_nodes","require","_types","_types2","_Core","isPushColorFilter","command","type","CommandType","PushColorFilter","exports","isColorFilter","colorFilterType","composeColorFilters","ctx","colorFilters","length","outer","pop","inner","push","Skia","ColorFilter","MakeCompose","pushColorFilter","cf","NodeType","BlendColorFilter","props","mode","color","processColor","MakeBlend","BlendMode","enumKey","MatrixColorFilter","matrix","MakeMatrix","LerpColorFilter","t","second","first","Error","MakeLerp","LumaColorFilter","MakeLumaColorFilter","LinearToSRGBGammaColorFilter","MakeLinearToSRGBGamma","SRGBToLinearGammaColorFilter","MakeSRGBToLinearGamma"],"sources":["ColorFilters.ts"],"sourcesContent":["import { enumKey, processColor } from \"../../../dom/nodes\";\nimport type {\n  BlendColorFilterProps,\n  LerpColorFilterProps,\n  MatrixColorFilterProps,\n} from \"../../../dom/types\";\nimport { NodeType } from \"../../../dom/types\";\nimport type { SkColorFilter } from \"../../../skia/types\";\nimport { BlendMode } from \"../../../skia/types\";\nimport { CommandType } from \"../Core\";\nimport type { Command } from \"../Core\";\nimport type { DrawingContext } from \"../DrawingContext\";\n\nexport const isPushColorFilter = (\n  command: Command\n): command is Command<CommandType.PushColorFilter> => {\n  \"worklet\";\n  return command.type === CommandType.PushColorFilter;\n};\n\ntype Props = {\n  [NodeType.BlendColorFilter]: BlendColorFilterProps;\n  [NodeType.MatrixColorFilter]: MatrixColorFilterProps;\n  [NodeType.LerpColorFilter]: LerpColorFilterProps;\n  [NodeType.LumaColorFilter]: Record<string, never>;\n  [NodeType.LinearToSRGBGammaColorFilter]: Record<string, never>;\n  [NodeType.SRGBToLinearGammaColorFilter]: Record<string, never>;\n};\n\ninterface PushColorFilter<T extends keyof Props>\n  extends Command<CommandType.PushColorFilter> {\n  colorFilterType: T;\n  props: Props[T];\n}\n\nconst isColorFilter = <T extends keyof Props>(\n  command: Command<CommandType.PushColorFilter>,\n  type: T\n): command is PushColorFilter<T> => {\n  \"worklet\";\n  return command.colorFilterType === type;\n};\n\nexport const composeColorFilters = (ctx: DrawingContext) => {\n  \"worklet\";\n  if (ctx.colorFilters.length > 1) {\n    const outer = ctx.colorFilters.pop()!;\n    const inner = ctx.colorFilters.pop()!;\n    ctx.colorFilters.push(ctx.Skia.ColorFilter.MakeCompose(outer, inner));\n  }\n};\n\nexport const pushColorFilter = (\n  ctx: DrawingContext,\n  command: Command<CommandType.PushColorFilter>\n) => {\n  \"worklet\";\n  let cf: SkColorFilter | undefined;\n  if (isColorFilter(command, NodeType.BlendColorFilter)) {\n    const { props } = command;\n    const { mode } = props;\n    const color = processColor(ctx.Skia, props.color);\n    cf = ctx.Skia.ColorFilter.MakeBlend(color, BlendMode[enumKey(mode)]);\n  } else if (isColorFilter(command, NodeType.MatrixColorFilter)) {\n    const { matrix } = command.props;\n    cf = ctx.Skia.ColorFilter.MakeMatrix(matrix);\n  } else if (isColorFilter(command, NodeType.LerpColorFilter)) {\n    const { props } = command;\n    const { t } = props;\n    const second = ctx.colorFilters.pop();\n    const first = ctx.colorFilters.pop();\n    if (!first || !second) {\n      throw new Error(\"LerpColorFilter requires two color filters\");\n    }\n    cf = ctx.Skia.ColorFilter.MakeLerp(t, first, second);\n  } else if (isColorFilter(command, NodeType.LumaColorFilter)) {\n    cf = ctx.Skia.ColorFilter.MakeLumaColorFilter();\n  } else if (isColorFilter(command, NodeType.LinearToSRGBGammaColorFilter)) {\n    cf = ctx.Skia.ColorFilter.MakeLinearToSRGBGamma();\n  } else if (isColorFilter(command, NodeType.SRGBToLinearGammaColorFilter)) {\n    cf = ctx.Skia.ColorFilter.MakeSRGBToLinearGamma();\n  }\n  if (!cf) {\n    throw new Error(`Unknown color filter type: ${command.colorFilterType}`);\n  }\n  ctx.colorFilters.push(cf);\n};\n"],"mappings":"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","ignoreList":[]}