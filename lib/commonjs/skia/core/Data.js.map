{"version":3,"names":["_react","require","_Skia","_Platform","factoryWrapper","data2","factory","onError","factoryResult","Error","loadData","source","undefined","Promise","resolve","Uint8Array","Skia","Data","fromBytes","uri","Platform","resolveAsset","fromURI","then","d","exports","useLoading","loader","mounted","useRef","data","setData","useState","dataRef","useEffect","current","value","useCollectionLoading","result","filter","r","useRawData","identity","useData"],"sources":["Data.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\n\nimport { Skia } from \"../Skia\";\nimport type { SkData, DataSourceParam, SkJSIInstance } from \"../types\";\nimport { Platform } from \"../../Platform\";\n\nconst factoryWrapper = <T>(\n  data2: SkData,\n  factory: (data: SkData) => T,\n  onError?: (err: Error) => void\n) => {\n  const factoryResult = factory(data2);\n  if (factoryResult === null) {\n    onError && onError(new Error(\"Could not load data\"));\n    return null;\n  } else {\n    return factoryResult;\n  }\n};\n\nexport const loadData = <T>(\n  source: DataSourceParam,\n  factory: (data: SkData) => T | null,\n  onError?: (err: Error) => void\n): Promise<T | null> => {\n  if (source === null || source === undefined) {\n    return new Promise((resolve) => resolve(null));\n  } else if (source instanceof Uint8Array) {\n    return new Promise((resolve) =>\n      resolve(factoryWrapper(Skia.Data.fromBytes(source), factory, onError))\n    );\n  } else {\n    const uri =\n      typeof source === \"string\" ? source : Platform.resolveAsset(source);\n    return Skia.Data.fromURI(uri).then((d) =>\n      factoryWrapper(d, factory, onError)\n    );\n  }\n};\n\nconst useLoading = <T extends SkJSIInstance<string>>(\n  source: DataSourceParam,\n  loader: () => Promise<T | null>\n) => {\n  const mounted = useRef(false);\n  const [data, setData] = useState<T | null>(null);\n  const dataRef = useRef<T | null>(null);\n  useEffect(() => {\n    mounted.current = true;\n    loader().then((value) => {\n      if (mounted.current) {\n        setData(value);\n        dataRef.current = value;\n      }\n    });\n    return () => {\n      mounted.current = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [source]);\n  return data;\n};\n\nexport const useCollectionLoading = <T extends SkJSIInstance<string>>(\n  source: DataSourceParam[],\n  loader: () => Promise<(T | null)[]>\n) => {\n  const mounted = useRef(false);\n  const [data, setData] = useState<T[] | null>(null);\n  const dataRef = useRef<T[] | null>(null);\n\n  useEffect(() => {\n    mounted.current = true;\n    loader().then((result) => {\n      const value = result.filter((r) => r !== null) as T[];\n      if (mounted.current) {\n        setData(value);\n        dataRef.current = value;\n      }\n    });\n\n    return () => {\n      mounted.current = false;\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [source]);\n\n  return data;\n};\n\nexport const useRawData = <T extends SkJSIInstance<string>>(\n  source: DataSourceParam,\n  factory: (data: SkData) => T | null,\n  onError?: (err: Error) => void\n) => useLoading(source, () => loadData<T>(source, factory, onError));\n\nconst identity = (data: SkData) => data;\n\nexport const useData = (\n  source: DataSourceParam,\n  onError?: (err: Error) => void\n) => useRawData(source, identity, onError);\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,KAAA,GAAAD,OAAA;AAEA,IAAAE,SAAA,GAAAF,OAAA;AAEA,MAAMG,cAAc,GAAGA,CACrBC,KAAa,EACbC,OAA4B,EAC5BC,OAA8B,KAC3B;EACH,MAAMC,aAAa,GAAGF,OAAO,CAACD,KAAK,CAAC;EACpC,IAAIG,aAAa,KAAK,IAAI,EAAE;IAC1BD,OAAO,IAAIA,OAAO,CAAC,IAAIE,KAAK,CAAC,qBAAqB,CAAC,CAAC;IACpD,OAAO,IAAI;EACb,CAAC,MAAM;IACL,OAAOD,aAAa;EACtB;AACF,CAAC;AAEM,MAAME,QAAQ,GAAGA,CACtBC,MAAuB,EACvBL,OAAmC,EACnCC,OAA8B,KACR;EACtB,IAAII,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAKC,SAAS,EAAE;IAC3C,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAKA,OAAO,CAAC,IAAI,CAAC,CAAC;EAChD,CAAC,MAAM,IAAIH,MAAM,YAAYI,UAAU,EAAE;IACvC,OAAO,IAAIF,OAAO,CAAEC,OAAO,IACzBA,OAAO,CAACV,cAAc,CAACY,UAAI,CAACC,IAAI,CAACC,SAAS,CAACP,MAAM,CAAC,EAAEL,OAAO,EAAEC,OAAO,CAAC,CACvE,CAAC;EACH,CAAC,MAAM;IACL,MAAMY,GAAG,GACP,OAAOR,MAAM,KAAK,QAAQ,GAAGA,MAAM,GAAGS,kBAAQ,CAACC,YAAY,CAACV,MAAM,CAAC;IACrE,OAAOK,UAAI,CAACC,IAAI,CAACK,OAAO,CAACH,GAAG,CAAC,CAACI,IAAI,CAAEC,CAAC,IACnCpB,cAAc,CAACoB,CAAC,EAAElB,OAAO,EAAEC,OAAO,CACpC,CAAC;EACH;AACF,CAAC;AAACkB,OAAA,CAAAf,QAAA,GAAAA,QAAA;AAEF,MAAMgB,UAAU,GAAGA,CACjBf,MAAuB,EACvBgB,MAA+B,KAC5B;EACH,MAAMC,OAAO,GAAG,IAAAC,aAAM,EAAC,KAAK,CAAC;EAC7B,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAG,IAAAC,eAAQ,EAAW,IAAI,CAAC;EAChD,MAAMC,OAAO,GAAG,IAAAJ,aAAM,EAAW,IAAI,CAAC;EACtC,IAAAK,gBAAS,EAAC,MAAM;IACdN,OAAO,CAACO,OAAO,GAAG,IAAI;IACtBR,MAAM,CAAC,CAAC,CAACJ,IAAI,CAAEa,KAAK,IAAK;MACvB,IAAIR,OAAO,CAACO,OAAO,EAAE;QACnBJ,OAAO,CAACK,KAAK,CAAC;QACdH,OAAO,CAACE,OAAO,GAAGC,KAAK;MACzB;IACF,CAAC,CAAC;IACF,OAAO,MAAM;MACXR,OAAO,CAACO,OAAO,GAAG,KAAK;IACzB,CAAC;IACD;EACF,CAAC,EAAE,CAACxB,MAAM,CAAC,CAAC;EACZ,OAAOmB,IAAI;AACb,CAAC;AAEM,MAAMO,oBAAoB,GAAGA,CAClC1B,MAAyB,EACzBgB,MAAmC,KAChC;EACH,MAAMC,OAAO,GAAG,IAAAC,aAAM,EAAC,KAAK,CAAC;EAC7B,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAG,IAAAC,eAAQ,EAAa,IAAI,CAAC;EAClD,MAAMC,OAAO,GAAG,IAAAJ,aAAM,EAAa,IAAI,CAAC;EAExC,IAAAK,gBAAS,EAAC,MAAM;IACdN,OAAO,CAACO,OAAO,GAAG,IAAI;IACtBR,MAAM,CAAC,CAAC,CAACJ,IAAI,CAAEe,MAAM,IAAK;MACxB,MAAMF,KAAK,GAAGE,MAAM,CAACC,MAAM,CAAEC,CAAC,IAAKA,CAAC,KAAK,IAAI,CAAQ;MACrD,IAAIZ,OAAO,CAACO,OAAO,EAAE;QACnBJ,OAAO,CAACK,KAAK,CAAC;QACdH,OAAO,CAACE,OAAO,GAAGC,KAAK;MACzB;IACF,CAAC,CAAC;IAEF,OAAO,MAAM;MACXR,OAAO,CAACO,OAAO,GAAG,KAAK;IACzB,CAAC;;IAED;EACF,CAAC,EAAE,CAACxB,MAAM,CAAC,CAAC;EAEZ,OAAOmB,IAAI;AACb,CAAC;AAACL,OAAA,CAAAY,oBAAA,GAAAA,oBAAA;AAEK,MAAMI,UAAU,GAAGA,CACxB9B,MAAuB,EACvBL,OAAmC,EACnCC,OAA8B,KAC3BmB,UAAU,CAACf,MAAM,EAAE,MAAMD,QAAQ,CAAIC,MAAM,EAAEL,OAAO,EAAEC,OAAO,CAAC,CAAC;AAACkB,OAAA,CAAAgB,UAAA,GAAAA,UAAA;AAErE,MAAMC,QAAQ,GAAIZ,IAAY,IAAKA,IAAI;AAEhC,MAAMa,OAAO,GAAGA,CACrBhC,MAAuB,EACvBJ,OAA8B,KAC3BkC,UAAU,CAAC9B,MAAM,EAAE+B,QAAQ,EAAEnC,OAAO,CAAC;AAACkB,OAAA,CAAAkB,OAAA,GAAAA,OAAA","ignoreList":[]}