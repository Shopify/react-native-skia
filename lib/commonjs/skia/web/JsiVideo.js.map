{"version":3,"names":["_CanvasKitWebGLBufferImpl","require","_JsiSkImageFactory","_Host","_defineProperty","e","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","createVideo","CanvasKit","url","video","document","createElement","Promise","resolve","reject","src","style","display","crossOrigin","volume","addEventListener","body","appendChild","JsiVideo","JsiSkImageFactory","Error","exports","constructor","ImageFactory","videoElement","duration","framerate","throwNotImplementedOnRNWeb","setSurface","surface","webglBuffer","CanvasKitWebGLBufferImpl","nextImage","MakeImageFromNativeBuffer","seek","time","isNaN","currentTime","rotation","size","width","videoWidth","height","videoHeight","pause","play","setVolume","dispose","parentNode","removeChild"],"sources":["JsiVideo.ts"],"sourcesContent":["import type { CanvasKit, Surface } from \"canvaskit-wasm\";\n\nimport type { CanvasKitWebGLBuffer, Video, ImageFactory } from \"../types\";\n\nimport { CanvasKitWebGLBufferImpl } from \"./CanvasKitWebGLBufferImpl\";\nimport { JsiSkImageFactory } from \"./JsiSkImageFactory\";\nimport { throwNotImplementedOnRNWeb } from \"./Host\";\n\nexport const createVideo = async (\n  CanvasKit: CanvasKit,\n  url: string\n): Promise<Video> => {\n  const video = document.createElement(\"video\");\n  return new Promise((resolve, reject) => {\n    video.src = url;\n    video.style.display = \"none\";\n    video.crossOrigin = \"anonymous\";\n    video.volume = 0;\n    video.addEventListener(\"loadedmetadata\", () => {\n      document.body.appendChild(video);\n      resolve(new JsiVideo(new JsiSkImageFactory(CanvasKit), video));\n    });\n    video.addEventListener(\"error\", () => {\n      reject(new Error(`Failed to load video from URL: ${url}`));\n    });\n  });\n};\n\nexport class JsiVideo implements Video {\n  __typename__ = \"Video\" as const;\n\n  private webglBuffer: CanvasKitWebGLBuffer | null = null;\n\n  constructor(\n    private ImageFactory: ImageFactory,\n    private videoElement: HTMLVideoElement\n  ) {\n    document.body.appendChild(this.videoElement);\n  }\n\n  duration() {\n    return this.videoElement.duration * 1000;\n  }\n\n  framerate(): number {\n    return throwNotImplementedOnRNWeb<number>();\n  }\n\n  setSurface(surface: Surface) {\n    // If we have the surface, we can use the WebGL buffer which is slightly faster\n    // This is because WebGL cannot be shared across contextes.\n    // This can be removed with WebGPU\n    this.webglBuffer = new CanvasKitWebGLBufferImpl(surface, this.videoElement);\n  }\n\n  nextImage() {\n    return this.ImageFactory.MakeImageFromNativeBuffer(\n      this.webglBuffer ? this.webglBuffer : this.videoElement\n    );\n  }\n\n  seek(time: number) {\n    if (isNaN(time)) {\n      throw new Error(`Invalid time: ${time}`);\n    }\n    this.videoElement.currentTime = time / 1000;\n  }\n\n  rotation() {\n    return 0 as const;\n  }\n\n  size() {\n    return {\n      width: this.videoElement.videoWidth,\n      height: this.videoElement.videoHeight,\n    };\n  }\n\n  pause() {\n    this.videoElement.pause();\n  }\n\n  play() {\n    this.videoElement.play();\n  }\n\n  setVolume(volume: number) {\n    this.videoElement.volume = volume;\n  }\n\n  dispose() {\n    if (this.videoElement.parentNode) {\n      this.videoElement.parentNode.removeChild(this.videoElement);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}